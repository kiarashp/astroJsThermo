---
import { Calendar, Tag, ArrowLeft, FileText, Package } from "@lucide/astro";
import type { GetStaticPaths } from "astro";
import Layout from "@/layouts/Layout.astro";
import { getPublishedProducts, getRelatedProducts } from "@/utils/product";
import ProductRelatedCard from "@/components/sections/products/ProductRelatedCard.astro";
import { Image } from "astro:assets";
import { formattedDate } from "@/utils/helpers";

// Build static paths
export const getStaticPaths = (async () => {
  const products = await getPublishedProducts();

  return products.map((entry) => ({
    params: { productSlug: entry.slug },
    props: { entry },
  }));
}) satisfies GetStaticPaths;

// Build astro props
const { entry } = Astro.props;
const product = entry.data;
const { Content } = await entry.render();

// get related products
const relatedProducts = await getRelatedProducts(entry.slug, product.category);
---

<Layout
  pageTitle={product.title}
  description={product.description}
  canonicalURL={product.canonicalUrl}
  image={product.thumbnail.src}
  ogType="article"
  pubDate={product.pubDate}
>
  <article class="min-h-screen bg-base-100">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <!-- Back Button -->
      <a href="/product" class="btn btn-ghost btn-sm gap-2 mb-8">
        <ArrowLeft class="w-4 h-4" />
        Back to Products
      </a>

      <!-- Product Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 mb-16">
        <!-- Image Section -->
        <div class="card bg-base-200 overflow-hidden max-h-[40vh] lg:max-h-none">
          <figure class="w-full h-full">
            <Image
              src={product.thumbnail}
              alt={product.title}
              class="w-full h-full object-cover"
            />
          </figure>
        </div>

        <!-- Product Info Section -->
        <div class="flex flex-col">
          <!-- Category Badge -->
          <div class="flex items-center gap-2 mb-4">
            <span class="badge badge-primary badge-lg gap-2">
              <Tag class="w-3 h-3" />
              {product.category}
            </span>
          </div>

          <!-- Title -->
          <h1 class="text-4xl lg:text-5xl font-bold text-base-content mb-6">
            {product.title}
          </h1>

          <!-- Excerpt -->
          <p class="text-lg text-base-content/80 mb-8 leading-relaxed">
            {product.excerpt}
          </p>

          <!-- Key Info Card -->
          <div class="card bg-base-200 mb-8">
            <div class="card-body">
              <h3 class="card-title text-base-content gap-2">
                <Package class="w-5 h-5" />
                Product Information
              </h3>
              <div class="space-y-3 mt-4">
                <div class="flex justify-between items-center">
                  <span class="text-base-content/70">Category</span>
                  <span class="font-medium text-base-content"
                    >{product.category}
                  </span>
                </div>
                <div class="divider my-2"></div>
                <div class="flex justify-between items-center">
                  <span class="text-base-content/70">Published</span>
                  <span class="font-medium text-base-content"
                    >{formattedDate(product.pubDate)}
                  </span>
                </div>
                <div class="divider my-2"></div>
                <div class="flex justify-between items-center">
                  <span class="text-base-content/70">Product ID</span>
                  <span class="font-medium text-base-content"
                    >PROD-{product.id}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Contact CTA -->
          <div class="alert alert-info">
            <FileText class="w-5 h-5" />
            <div>
              <h4 class="font-bold">Need more information?</h4>
              <p class="text-sm">
                Contact our team for technical specifications and pricing.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Details -->
      <div class="card bg-base-100 shadow-xl mb-16">
        <div class="card-body p-8 lg:p-12">
          <h2
            class="text-3xl font-bold text-base-content mb-6 flex items-center gap-3"
          >
            <FileText class="w-7 h-7 text-primary" />
            Product Details
          </h2>
          <div class="prose prose-lg max-w-none dark:prose-invert">
            <Content />
          </div>
        </div>
      </div>
      <!-- related products -->
      <ProductRelatedCard products={relatedProducts} />
    </div>
  </article>
</Layout>
